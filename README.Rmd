---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# trelliscope

<!-- badges: start -->
[![R-CMD-check](https://github.com/trelliscope/trelliscope/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/trelliscope/trelliscope/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/trelliscope/trelliscope/branch/main/graph/badge.svg)](https://app.codecov.io/gh/trelliscope/trelliscope?branch=main)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

This repository contains an experimental rewrite of the trelliscopejs R package. It is currently under heavy development.

## Installation

You can install the development version of trelliscope from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("trelliscope/trelliscope")
```

## Example

```{r example}
library(trelliscope)
library(ggplot2, warn.conflicts = FALSE)
library(tidyr, warn.conflicts = FALSE)
library(dplyr, warn.conflicts = FALSE)

# create a data frame of metadata with a plot column
dat <- ggplot2::mpg |>
  tidyr::nest(data = !dplyr::one_of(c("manufacturer", "class"))) |>
  dplyr::mutate(
    mean_cty = purrr::map_dbl(data, function(x) mean(x$cty)),
    panel = map_plot(data, function(x) ggplot2::qplot(hwy, cty, data = x))
  )

dat

p <- ggplot(mpg, aes(hwy, cty)) +
  geom_point() +
  facet_trelliscope(~ manufacturer + class) +
  theme()

dat2 <- some_function(p) %>%
# output should look same as dat but without mean_cty
  dplyr::mutate(
    mean_cty = purrr::map_dbl(data, function(x) mean(x$cty))
  )


disp <- dat %>%
  trelliscope(name = "Highway mpg vs. City mpg") |>
  # provide information about metadata:
  add_meta_defs(
    meta_string("manufacturerrr", description = "Vehicle manufacturer name")
  )

disp <- dat %>%
  trelliscope(name = "Highway mpg vs. City mpg") |>
  # provide information about metadata:
  add_meta_defs(
    meta_string("manufacturer", description = "Vehicle manufacturer name"),
    meta_factor("class", description = "Type of vehicle",
      levels = c("subcompact", "compact", "2seater", "midsize", "suv",
        "minivan", "pickup")),
    meta_number("mean_cty", description = "Mean city miles per gallon",
      tags = "metrics")
  ) |>
  # alternately can use add_meta_from_csv()
  # set the initial viewing state:
  set_labels(c("manufacturer", "class")) |>
  set_sort(c("class", "mean_cty"), dir = c("asc", "asc")) |>
  set_layout(nrow = 2, ncol = 3)
  # set_filters()
  set_views(
    "Ordered by x" = view(
      set_labels(c("manufacturer", "class")),
      set_sort(c("class", "mean_cty"), dir = c("asc", "asc")),
      set_layout(nrow = 2, ncol = 3)
    ),
    "View 2" = view(...)
  )
  # set_inputs()
  # write_display()


# modify an existing display...
trelliscope(path) %>%
  set_layout(...)


```
