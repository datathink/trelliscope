---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# trelliscope

<!-- badges: start -->
[![R-CMD-check](https://github.com/trelliscope/trelliscope/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/trelliscope/trelliscope/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/trelliscope/trelliscope/branch/main/graph/badge.svg)](https://app.codecov.io/gh/trelliscope/trelliscope?branch=main)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

This repository contains an experimental rewrite of the trelliscopejs R package. It is currently under heavy development.

## Installation

You can install the development version of trelliscope from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("trelliscope/trelliscope")
```

## Example

A simple visualization of city vs. highway mpg by car manufacturer and class:

```{r example}
library(trelliscope)
library(ggplot2, warn.conflicts = FALSE)
library(tidyr, warn.conflicts = FALSE)
library(dplyr, warn.conflicts = FALSE)

# create a data frame of metadata with a plot column
dat <- ggplot2::mpg |>
  tidyr::nest(data = !dplyr::one_of(c("manufacturer", "class"))) |>
  dplyr::mutate(
    mean_cty = purrr::map_dbl(data, function(x) mean(x$cty)),
    panel = map_plot(data, function(x) ggplot2::qplot(hwy, cty, data = x))
  )

dat
```

We can specify a trelliscope display from this as easily as:

```{r}
disp <- dat |>
  trelliscope(name = "Highway mpg vs. City mpg")
```

But we can provide fine control over the app with the use of many additional utility functions:

```{r}
disp <- dat |>
  trelliscope(name = "Highway mpg vs. City mpg") |>
  # provide information about metadata:
  add_meta_defs(
    meta_string("manufacturer", label = "Vehicle manufacturer name"),
    meta_factor("class", label = "Type of vehicle",
      levels = c("subcompact", "compact", "2seater", "midsize", "suv",
        "minivan", "pickup")),
    meta_number("mean_cty", label = "Mean city miles per gallon",
      tags = "metrics")
  ) |>
  # alternately can use add_meta_from_csv()
  # set the initial viewing state:
  set_labels(c("manufacturer", "class", "mean_cty")) |>
  set_sort(c("class", "mean_cty"), dir = c("asc", "asc")) |>
  set_layout(nrow = 2, ncol = 3) |>
  set_filters(
    filter_string("manufacturer", values = c("audi", "volkswagen")),
    filter_range("mean_cty", min = 20)
  ) |>
  add_view(
    name = "test view",
    state_layout(nrow = 3, ncol = 5),
    state_labels(c("class", "manufacturer")),
    state_sort("manufacturer"),
    state_sort("mean_cty", "desc"),
    filter_string("manufacturer",
      values = c("toyota", "honda", "nissan", "subaru")),
    filter_range("mean_cty", max = 20)
  ) |>
  add_view(
    name = "test view 2",
    state_sort("class"),
    filter_range("mean_cty", min = 15, max = 25)
  ) |>
  add_inputs(
    input_radio(name = "good_radio",
      label = "Is it good?", options = c("no", "yes")),
    input_checkbox(name = "good_checkbox",
      label = "Is it good?", options = c("no", "yes")),
    input_select(name = "good_select",
      label = "Is it good?", options = c("no", "yes")),
    input_multiselect(name = "good_multiselect",
      label = "Is it good?", options = c("no", "yes")),
    input_text(name = "opinion", label = "What do you think?",
      width = 100, height = 6),
    input_number(name = "rank", label = "Rank this panel")
  )
  # write_display()
```

To see what the JSON representation of this looks like:

```{r}
disp |> as_json()
```
